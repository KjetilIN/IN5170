# Exam 2022

## Exercise 1

We consider a program state in which the two program variables x and y both
have the value 5. Consider the following program:

```text
< x := x + y > || < y := y + x>
```

### 1a) Is your program interference-free? Explain your answer (1p.)

For a program to be interference free when the two processes does not write to the two variables. 
In this case it does. This means that the result will be different depending on the order of the parallel processes. 


### 1b) Do the processes satisfy the at-most-once property? Explain your answer (1p.)

We can consider the AMO-property for assignment by defining writes and reads for each variable:
```text
V_{S1} = {x, y}
W_{S1} = {x}

V_{S2} = {x, y}
W_{S2} = {y}


V_{S1} U W_{S2} = {y}
V_{S2} U W_{S1} = {x}
```

We can see that reading and writing interfere with each other. This means the AMO property does not hold. 
We can also see this in 1c), which shows that the different order of execution leads to different results. 


### 1c) What are possible pre- and post-conditions for the program? (2p.)

The task states that both variables start with 5 then the only pre condition is: 

```text
{x:= 5, y:=5}
```

However, the end condition based on the order of the program could be:

```text
S1 -> S2 => {x:= 10, y:= 15}
S2 -> S1 => {x:= 15, y:= 10}
```

As we can see, there is two orders different orders that is possible, which leads to two different orders of the program.

### 1d) Prove your post-condition using program logic for all states that satisfy the pre-condition (3p.)

We can write the post condition logic with the following notation:

```math
(x:= 10 \wedge y:= 15) \lor (x:= 15 \land y:= 10) 
```


## Exercise 2 

TODO: after session types lecture 

## Exercise 3

Explain the difference between weak and strong fairness

Weak fairness ensures that if a process is enabled and remains enabled, it must eventually execute.
Strong fairness ensures that if a process is enabled infinitely often, it must eventually execute.


## Exercise 4 - Semaphores 

We consider a barbershop with one barber and a waiting room with n chairs for waiting customers
(n may be 0). The following rules apply:
- If there are no customers, the barber falls asleep
- A customer must wake the barber if he is asleep
- If a customer arrives while the barber is working, the customer leaves if all chairs are
occupied and sits in an empty chair if itâ€™s available
- When the barber finishes a haircut, he inspects the waiting room to see if there are any
waiting customers and falls asleep if there are none


### 4 a)
Complete the code below to provide a solution based on semaphores
that ensures the following requirements:
- the barber never sleeps while there are waiting customers and
- there is never more than n customers waiting in the waiting room.

Briefly explain why your solution satisfies these requirements

```text
int freeSeats = n;

// Acts as a mutex from grabbing the seat in the waiting room 
sem grabSeatMutex := 1; 

// One available barber 
sem barber:= 1;

process Customer{
    while(true){
        // Mutex grab 
        P(grabSeatMutex);
        // Grab a seat if available, else leave
        if (freeSeats <= 0){
            V(grabSeatMutex);
            continue;
        }else{
            // We can grab a seat
            freeSeats -= 1;
        }
        V(grabSeatMutex);


        // Grab barber and get a haircut 
        P(barber);
    }
}

process Barber{
    while(true){


    }
}
```