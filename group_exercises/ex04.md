# Exercise 4 - Channels and Message Passing

## Q1

Consider a filter process `Partition` having the following specifications. `Partition` receives unsorted integers values from one input channel `in` and send the values it receives to one of two output channels, `out1` or `out2`. Partition uses the first value v it receives to partition the input values into two sets. It sends all values less than or equal to v to `out1` and all values greater than v to out2. Finally, Partition sends v to `out1` and sends a sentinel EOS to both `out1` and `out2`. The end of the input stream is marked by a sentinel `EOS`. 

Develop an implementation of Partition. First, give predicates specifying the contents of the channels, then develop the body of Partition.


#### Solution 

Predicate that holds for all channel. 
First defining variables:
- let n be the number of values sent, including v, excluding EOS
- let i be the i'th value of in channel
- let m be the number of proper values (excluding m) send to out1, excluding EOS 

Then we chain what we know must be true at all the states:

```math
empty(in) \land \\
in[0] = v \land \\
\forall 1 <= i <= m \forall 1 <= j <= (n-m): out1[i] < out2[j] \land \\
\forall 1 <= i <= m : out1[i] <= v \land \\
\forall 1 <= i <= (n-m) : out2[i] > v \land \\
out1[m] = v \land \\
out1[m + 1] = EOS \land \\
out2[n + 1] = EOS \land

```



Implemented like this: 

```text
chan in(int), out1(int), out2(int);

process Partition{
    int v; 
    int current_val;

    // Take the two first input as v and then the next val
    receive in(v);
    receive in(current_val);

    // While not end of stream 
    while(current_val != EOS){
        if current_val < v{
            send out1(current_val);
        }else{
            send out2(current_val);
        }
        
        // Get new value from input channel 
        receive in(current_val);
    }

    // Send the V value at the end
    send out1(v);

    // Close the channels 
    close out1;
    close out2;
}
```

It fails if the input stream starts with EOS. Then the program needs to check for this.